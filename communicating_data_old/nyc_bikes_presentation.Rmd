---
title: "NYC Citi Bike trips"
output:
  html_document:
    toc: true
    toc_float: true
    df_print: paged
#    code_folding: show
date: "`r format(Sys.Date())`"
author: "Lesley Duff"
editor_options: 
  chunk_output_type: inline
---
```{r}
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

```{}
#knitr::opts_chunk$set(echo = FALSE, fig.align = "center")
```
# Introduction

[*Citi Bike*](https://ride.citibikenyc.com/about) is the largest [bike share system](https://en.wikipedia.org/wiki/Bicycle-sharing_system) in the USA and 
consists of a fleet of bikes available to hire by users at docking stations 
throughout New York City. Bikes can be returned to any other station. Citi Bike 
is available for use 24 hours/day, 7 days/week, 365 days/year.

Citi Bike would like to know more about the following:

* What is the pattern of bike hires over time?
* Do hire patterns differ by rider demographics such as age/gender/type of user
* Hires by geographical spread
* Other insights?

The data provided to us is a small sample about bike hires. This is what we are 
using to do some analysis.

## Ethics



### Human Rights
#### Privacy
Bike hire data relates to the actions of people using the bikes which are hired 
when a user starts a journey using one from a docking station.

The data relating to people includes information about the gender of the person 
and the year of their birth. Also whether they have purchased either a 24-hour 
or 3-day pass, or a "Subscriber" who has purchased an annual subscription.

The start location indicating which station the user started the journey and 
where they were and which station at the end. 

There may be some potential concerns that the location data could be used to 
track where a particular person is but the data is anonymised so that there is 
nothing more specific that could be used to identify a particular individual. 

```{r}
library(ggthemes) # Contains colourblind palette
library(scales)
library(tsibble) # time series tibble for the tidyverse
library(tidyverse)
# library(tsibbledata) # contains nyc_bikes dataset
```

```{r}
# Get helper functions ----
source("R/nyc_bikes_helpers.R")
```


```{r include=FALSE}
# Load data set ----
# Use cleaned version
nyc_bikes_clean <- read_csv("clean_data/nyc_bikes_clean.csv")
```


## General

```{r}
trip_count <- get_trip_count(nyc_bikes_clean)
bike_count <- get_bike_count(nyc_bikes_clean)
start_station_count <- get_start_station_count(nyc_bikes_clean)
end_station_count <- get_end_station_count(nyc_bikes_clean)
```

|Count  | Name |  Description  |
| --------------: | ----- | ------------------ |
| `r trip_count` | trips | bike hires made |
| `r bike_count` | bikes in Citi Bike fleet | bikes used for trips |
| `r start_station_count` | docking stations | used to start trips |
| `r end_station_count` | docking stations | used to end trips |

The population of New York City in 2018 was 

# Time

Here we take a look at hires over time.

```{r}
# start_times_df <- nyc_bikes_df %>%
#  select(start_time) %>%
#  index_by(start_time) # %>%
##  summarise(mean_temp = mean(Temperature))
## summarise(hire_start_time_count = n())
```
## Month

This graph shows how many bike hires there were for each month of 2018.

```{r}
# Convert to tsibble ?as_tsibble
nyc_bikes_clean <- as_tsibble(nyc_bikes_clean, index = start_time)

# View(month_hires_count)
month_hires_count <- get_month_hires_count(nyc_bikes_clean)

month_nyc_bikes_plot <- month_hires_count %>%
  ggplot(aes(x = month_name, y = hires_month_count)) +
  geom_point() +
  geom_line(group = 1) +
  # geom_text(aes(label = hires_month_count))+
  scale_y_continuous(limits = c(0, 800)) +
  theme_minimal() +
  #  theme_tufte() +

  labs(
    x = "\nMonth",
    y = "Number of hires\n",
    title = "Bike Hire by Month",
    subtitle = "Sample data from 2018"
  )

month_nyc_bikes_plot
```

* The highest levels of usage are in the summer months, peaking in August with a total of **`r max(month_hires_count$hires_month_count)`** hires.
* The lowest levels of usage are in the winter months, lowest in February with a total of **`r min(month_hires_count$hires_month_count)`** hires.

```{r}
# get_month_hires_count = function(df)
#  hires_per_bike <- df %>%
#  # ?count
#  # bike_count =
#    count(bike_id, name = "hire_count", sort = TRUE)

# bike_hires <- get_bike_hires(nyc_bikes_clean)
# bike_hires
```

## Day of Month

Here were are comparing how the pattern of usage changes during each month.

```{r}
hires_day_of_month <- nyc_bikes_clean %>%
  select(start_time, month) %>%
  mutate(month_label = lubridate::month(month, label = TRUE, abbr = TRUE))

hires_day_of_month %>%
  ggplot(aes(x = day(start_time))) +
  geom_histogram(
    color = "white",
    fill = "steelblue",
    binwidth = 1
  ) + # ?facet_wrap
  facet_wrap(~month_label,
    ncol = 3
  ) +
  theme_tufte() +
  labs(
    x = "\nDay of Month",
    y = "Number of Hires\n",
    title = "Bike Hire by Day of Month",
    subtitle = "Sample data from 2018"
  )
```

There's a gap showing next to no hires for more than a week in the middle of January. This should be examined further to see if other factors such as poor weather might be affecting hires. 

August shows

## Day of Week

Are there any patterns to whether there are particular days of the week that are more popular? How does usage change at weekends?

```{r}
weekend_daynames <- c("Sat", "Sun")

hires_day_of_week <- nyc_bikes_clean %>%
  select(start_time) %>%
  mutate(day_of_week = lubridate::wday(start_time, label = TRUE, abbr = TRUE))

hires_day_of_week %>% 
  ggplot(aes(x = day_of_week, 
             fill = day_of_week %in% weekend_daynames)
         )+
  geom_bar(alpha = 0.7)+
  scale_fill_colorblind("Type of Day",
                      labels=c("Weekday", "Weekend"))+
  theme_minimal()+
  labs(
    x = "\nDay of Week",
    y = "Number of Hires\n",
    title = "Bike Hire by Day of Week",
    subtitle = "Sample data from 2018",
    fill = "",
  )
```

* Tuesday is the day of the week with the highest hires.
* Sunday is the day of the week with the lowest hires

* Weekdays have higher levels of usage than weekends.
* Weekend usage isn't substantially lower than weekdays. 

_Citi Bike_ might like to whether customers using the 
bikes on weekdays are largely the same people. 
Do different people use bike sharing at weekends? Are there differences between 'commuter' patterns and those for leisure.

# Recommendations

* We have not been given any information relating to any promotional or 
marketing activities. Particularly with our time-based




